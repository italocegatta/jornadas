## ----message=FALSE, warning=FALSE----------------------------------------------------------------------------------------------------
library(tidyverse)
library(readxl)

tab_ifc <- read_excel("input/jpf_ifc_ms.xlsx")

tab_ifc


## ------------------------------------------------------------------------------------------------------------------------------------
ggplot(data = tab_ifc, aes(x = imatcc)) +
  geom_histogram() 


## ------------------------------------------------------------------------------------------------------------------------------------
ggplot(data = tab_ifc, aes(x = dap, y = altura)) +
    geom_point()


## ------------------------------------------------------------------------------------------------------------------------------------
ggplot(data = tab_ifc, aes(x = dap, y = altura)) +
  geom_point() +
  geom_smooth()


## ------------------------------------------------------------------------------------------------------------------------------------
tab_ifc_modificado <- mutate(tab_ifc, vol_individual = pi * dap^2 * 1/4000 * altura * 0.5)
tab_ifc_modificado


## ------------------------------------------------------------------------------------------------------------------------------------
vec_vol_individual <- pull(tab_ifc_modificado, vol_individual)

mean(vec_vol_individual)


## ------------------------------------------------------------------------------------------------------------------------------------
vec_vol_individual <- pull(mutate(tab_ifc, vol_individual = pi * dap^2 * 1/4000 * altura * 0.5))

mean(vec_vol_individual)


## ------------------------------------------------------------------------------------------------------------------------------------
mean(pull(mutate(tab_ifc, vol_individual = pi * dap^2 * 1/4000 * altura * 0.5), vol_individual))


## ------------------------------------------------------------------------------------------------------------------------------------
tab_ifc %>% 
  mutate(vol_individual = pi * dap^2 * 1/4000 * altura * 0.5) %>% 
  pull(vol_individual) %>% 
  mean()


## ------------------------------------------------------------------------------------------------------------------------------------
library(tidyverse)
library(readxl)


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima <- read_excel("input/jpf_clima.xlsx")

tab_clima


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima, tmed > 32)


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima, tmed > 32 & ppt < 10)


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima, tmed > 32 | ppt > 400)


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima, site == "ribas")


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima, site %in% c("ribas", "tres_lagoas"))


## ------------------------------------------------------------------------------------------------------------------------------------
arrange(tab_clima, tmed)


## ------------------------------------------------------------------------------------------------------------------------------------
arrange(tab_clima, -tmed)


## ------------------------------------------------------------------------------------------------------------------------------------
select(tab_clima, site, ano, mes, ppt)


## ------------------------------------------------------------------------------------------------------------------------------------
select(tab_clima, site:doy)


## ------------------------------------------------------------------------------------------------------------------------------------
select(tab_clima, -(seq:lat))


## ------------------------------------------------------------------------------------------------------------------------------------
mutate(
  tab_clima,
  temp_otima = tmed >= 18 & tmed <= 22
)


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima_modificado <- mutate(
  tab_clima,
  temp_otima = tmed >= 18 & tmed <= 22
)

tab_clima_modificado


## ------------------------------------------------------------------------------------------------------------------------------------
summarise(tab_clima, tmed_media = mean(tmed))


## ------------------------------------------------------------------------------------------------------------------------------------
summarise(tab_clima, ppt_media = mean(ppt))


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima_agrupado_ano <- group_by(tab_clima, ano)

summarise(tab_clima_agrupado_ano, tmed_media = mean(tmed))


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima_agrupado_site_ano <- group_by(tab_clima, site, ano)

tab_clima_site_ano <- summarise(
  tab_clima_agrupado_site_ano,
  tmed_anual = mean(tmed),
  ppt_anual = sum(ppt)
)

tab_clima_site_ano 


## ------------------------------------------------------------------------------------------------------------------------------------
filter(tab_clima_site_ano, ppt_anual < 700)


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima %>%
  group_by(site, ano) %>% 
  summarise(
    tmed_anual = mean(tmed),
    ppt_anual = sum(ppt)
  ) %>% 
  filter(ppt_anual < 700)


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima %>% 
  filter(site == "ribas", mes == 1) %>% 
  select(site, ano, mes, tmed) %>% 
  arrange(desc(tmed)) %>% 
  slice(1:5)


## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima %>% 
  group_by(site, mes) %>% 
  summarise(
    tmed_mensal = mean(tmed)
  ) %>% 
  ggplot(aes(mes,tmed_mensal, color = site)) +
    geom_line() +
    scale_x_continuous(breaks = 1:12) +
    theme_bw()

## ------------------------------------------------------------------------------------------------------------------------------------
tab_clima %>%
  group_by(site, ano) %>% 
  summarise(ppt_anual = sum(ppt)) %>% 
  ungroup() %>% 
  mutate(site = fct_reorder(site, ppt_anual)) %>% 
  ggplot(aes(ano, site, fill = ppt_anual)) +
    geom_tile() +
    scale_fill_viridis_b() +
    theme_bw()


## ------------------------------------------------------------------------------------------------------------------------------------
tab_ifc %>% 
  group_by(matgen) %>% 
  summarise(imatcc = mean(imatcc)) %>% 
  top_n(10, imatcc) %>% 
  mutate(matgen = fct_reorder(matgen, -imatcc)) %>% 
  ggplot(aes(matgen, imatcc)) +
    geom_col() +
    theme_bw()


## ------------------------------------------------------------------------------------------------------------------------------------
tab_ifc %>% 
  ggplot(aes(area_basal, altura_dom)) +
    geom_point(alpha = 0.03) +
    geom_smooth(method = "lm") +
    theme_bw()

